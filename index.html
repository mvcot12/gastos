<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Plan de Viaje</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--g:rgba(255,255,255,.28);--b:blur(16px);--a:#2f3c7e;--p1:#f6f4ff;--p2:#d2e4fa}
*{box-sizing:border-box}body{margin:0;padding:1rem;font-family:-apple-system,Helvetica,Arial,sans-serif;background:linear-gradient(135deg,var(--p1),var(--p2));color:#222}
header{backdrop-filter:var(--b);background:var(--g);border-radius:20px;padding:1rem;margin-bottom:1.2rem;box-shadow:0 4px 18px rgba(0,0,0,.15)}
h1{margin:0;font-size:1.4rem;color:var(--a)}.count{font-family:monospace;font-size:1rem;text-align:center;margin-top:.4rem}
.grid{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem}.card{flex:1 1 155px;background:var(--g);backdrop-filter:var(--b);padding:.9rem;border-radius:18px;text-align:center;box-shadow:0 1px 6px rgba(0,0,0,.12)}
.card h2{margin:.2rem 0;font-size:.92rem;color:var(--a)}
input,select,button{width:100%;padding:.55rem;margin-top:.35rem;border-radius:12px;border:1px solid #ccc;font-size:.9rem}
button{background:var(--a);color:#fff;border:none;cursor:pointer}
details{margin-bottom:1rem}summary{cursor:pointer;font-weight:600;margin-bottom:.5rem}
table{width:100%;border-collapse:collapse;font-size:.84rem}th,td{padding:.32rem;border-bottom:1px solid #ddd;text-align:left}
tr.done td{text-decoration:line-through;opacity:.45}fieldset{border:none;padding:0;margin:0}
@media(max-width:480px){.card{flex:1 1 120px}}
</style>
</head><body>
<header>
  <h1>Plan de Viaje</h1>
  <div id="countdown" class="count">Sin configuraci√≥n</div>
</header>

<!-- === RESUMEN GASTOS (igual que v4.1) -->
<section class="grid" id="mainSummary">
  <div class="card"><h2>Presupuesto plan</h2><span id="sumBudget">$0</span></div>
  <div class="card"><h2>Gastado real</h2><span id="sumSpent">$0</span></div>
  <div class="card"><h2>Diferencia</h2><span id="sumDiff">$0</span></div>
  <div class="card"><h2>Extra disponible</h2><span id="sumExtra">$0</span></div>
</section>
<section class="grid" id="dynamicCards"></section>

<!-- === CONFIGURAR VIAJE === -->
<details id="configBox" open>
 <summary>üóìÔ∏è Configurar viaje</summary>
 <fieldset>
  <label>Fecha inicio</label><input type="date" id="tripStart">
  <label>Fecha fin</label><input type="date" id="tripEnd">
  <label>Fecha l√≠mite edici√≥n plan</label><input type="date" id="tripLock">
  <button type="button" onclick="saveTrip()">Guardar fechas</button>
 </fieldset>
</details>

<!-- === PLANIFICACI√ìN ACTIVIDADES === -->
<details id="actBlock">
 <summary>üìÖ Planificaci√≥n de actividades</summary>

 <table id="actTbl">
  <thead><tr><th>D√≠a</th><th>Inicio</th><th>Fin</th><th>Categor√≠a</th><th>Descripci√≥n</th><th>‚úîÔ∏é</th></tr></thead>
  <tbody></tbody>
 </table>

 <fieldset>
  <select id="aDia"></select>
  <input type="time" id="aIni">
  <input type="time" id="aFin">
  <select id="aCat"></select>
  <input type="text" id="aTxt" placeholder="Descripci√≥n">
  <button type="button" onclick="addAct()">A√±adir actividad</button>
 </fieldset>
</details>

<!-- === PLANIFICACI√ìN GASTOS (igual que v4.1) -->
<details id="planBlock">
 <summary>üí∏ Planificaci√≥n de gastos</summary>
 <!-- ... (el mismo contenido de la versi√≥n 4.1) ... -->
</details>

<!-- === GASTO REAL & LISTA GASTOS (igual que v4.1) -->
<details id="realBlock" open>
 <!-- ... -->
</details>
<details><summary>üóíÔ∏è Gastos registrados</summary><ul id="lista"></ul></details>

<script>
/* ==== CONSTANTES Y DATOS (se mantienen) ==== */
const BANKS=["Pichincha","Pacifico","Internacional","Guayaquil","Produbanco","JEP","Policia","Austro","Bolivariano"];
const CATS_FIXED=["Buseta","Alquiler de carro","Hotel","GOLO","Entretenimiento","Comida","Aeropuerto","Snacks","Extras paseo","Transporte","Parqueo"];
const CATS_POOL=["Ropa","Propinas","Gasolina"];
const LS="planViajeDataV42";
let data=JSON.parse(localStorage.getItem(LS)||'{"meta":{},"plan":[],"actividades":[],"gastos":[]}');
const fmt=n=>'$'+(+n).toFixed(2);
function save(){localStorage.setItem(LS,JSON.stringify(data));}

/* ==== POBLAR SELECTS ==== */
function fill(sel,arr){sel.innerHTML=arr.map(v=>`<option>${v}</option>`).join("")}
fill(document.getElementById('aCat'),[...CATS_FIXED,...CATS_POOL]);
fill(document.getElementById('gCat'),[...CATS_FIXED,...CATS_POOL]);
fill(document.getElementById('pCat'),[...CATS_FIXED,...CATS_POOL]);
fill(document.getElementById('pBank'),BANKS);fill(document.getElementById('gBank'),BANKS);

/* ==== D√çAS DIN√ÅMICOS ==== */
function rebuildDiaOptions(){
  const sel=document.getElementById('aDia'); sel.innerHTML='';
  const sel2=document.getElementById('pDia'); sel2.innerHTML='';
  if(data.meta.start&&data.meta.end){
    const s=new Date(data.meta.start),e=new Date(data.meta.end);
    const n=Math.round((e-s)/86400000)+1;
    for(let i=1;i<=n;i++){
      sel.innerHTML+=`<option value="${i}">D√≠a ${i}</option>`;
      sel2.innerHTML+=`<option value="${i}">D√≠a ${i}</option>`;
    }
  }
  sel2.innerHTML+='<option>Todos</option>';
} 

function saveTrip(){data.meta.start=tripStart.value;data.meta.end=tripEnd.value;data.meta.lock=tripLock.value;save();rebuildDiaOptions();renderUI();tick();configBox.open=false;}

/* ==== ACTIVIDADES ==== */
function addAct(){
  const dia=aDia.value,ini=aIni.value,fin=aFin.value,cat=aCat.value,txt=aTxt.value.trim();
  if(!ini||!txt){alert('Hora inicio y descripci√≥n obligatorias');return;}
  data.actividades.push({id:crypto.randomUUID(),dia:+dia,ini,fin,cat,txt,done:false});
  save();renderActTable();
  aIni.value='';aFin.value='';aTxt.value='';
}
function toggleAct(id){
  const a=data.actividades.find(x=>x.id===id);if(a){a.done=!a.done;save();renderActTable();}
}
function renderActTable(){
  const tb=document.querySelector('#actTbl tbody');tb.innerHTML='';
  data.actividades.sort((a,b)=>a.dia-b.dia||a.ini.localeCompare(b.ini)).forEach(a=>{
    const tr=document.createElement('tr');if(a.done)tr.classList.add('done');
    tr.innerHTML=`<td>D√≠a ${a.dia}</td><td>${a.ini}</td><td>${a.fin||''}</td>
      <td>${a.cat}</td><td>${a.txt}</td>
      <td><input type="checkbox" ${a.done?'checked':''} onclick="toggleAct('${a.id}')"></td>`;
    tb.appendChild(tr);
  });
}

/* ==== RESTO DE C√ìDIGO (v4.1) ==== */
/*  - Planificaci√≥n gastos, gastos reales, res√∫menes, countdown, etc.
    (se mantiene igual; recorta aqu√≠ por brevedad) */

function renderUI(){rebuildDiaOptions();renderActTable();/* + funciones v4.1 */}

/* init */
renderUI();tick();setInterval(tick,1e3);
</script>
</body></html>
